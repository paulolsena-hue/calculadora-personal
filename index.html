<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Custos PT - Offline</title>
    <!-- Configura√ß√µes para iOS (modo tela cheia) -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Custos PT">
    
    <!-- CSS Incorporado: Garante que o estilo funcione offline. -->
    <style>
        :root {
            --font-inter: 'Inter', sans-serif;
            --color-indigo-800: #3730a3;
            --color-indigo-200: #e0e7ff;
            --color-indigo-600: #4f46e5;
            --color-indigo-100: #eef2ff;
        }

        html { font-family: var(--font-inter); }
        body { min-height: 100vh; background-color: #f9fafb; }
        .container { max-width: 800px; }
        
        .mx-auto { margin-left: auto; margin-right: auto; }
        .p-4 { padding: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .pb-2 { padding-bottom: 0.5rem; }
        .text-3xl { font-size: 1.5rem; line-height: 2rem; }
        @media (min-width: 640px) { .text-3xl { font-size: 1.875rem; } }
        .font-extrabold { font-weight: 800; }
        .text-indigo-800 { color: var(--color-indigo-800); }
        .border-b-4 { border-bottom-width: 4px; }
        .border-indigo-200 { border-color: var(--color-indigo-200); }

        .bg-white { background-color: white; }
        .shadow-xl { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
        .rounded-2xl { border-radius: 1rem; }
        .border { border-width: 1px; }
        .border-indigo-100 { border-color: var(--color-indigo-100); }
        .text-xl { font-size: 1.25rem; font-weight: 600; color: #4338ca; }
        .mb-4 { margin-bottom: 1rem; }
        .grid { display: grid; }
        .grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        .gap-3 { gap: 0.75rem; }
        .text-center { text-align: center; }
        .text-sm { font-size: 0.875rem; }
        .text-gray-500 { color: #6b7280; }
        .mt-4 { margin-top: 1rem; }
        .font-bold { font-weight: 700; }

        .bg-indigo-600 { background-color: var(--color-indigo-600); }
        .text-white { color: white; }
        .rounded-xl { border-radius: 0.75rem; }
        .flex { display: flex; }
        .justify-between { justify-content: space-between; }
        .items-center { align-items: center; }
        .flex-col { flex-direction: column; }
        
        .overflow-x-auto { overflow-x: auto; -webkit-overflow-scrolling: touch; }
        .min-w-full { min-width: 100%; }
        .bg-indigo-50 { background-color: #f3f4f6; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
        .text-xs { font-size: 0.75rem; }
        .uppercase { text-transform: uppercase; }
        .sticky { position: sticky; }
        .left-0 { left: 0; }
        .z-10 { z-index: 10; }
        .whitespace-nowrap { white-space: nowrap; }

        /* Cores de Sess√£o */
        .bg-red-500 { background-color: #ef4444; }
        .bg-yellow-500 { background-color: #f59e0b; }
        .bg-green-500 { background-color: #10b981; }
        .bg-blue-500 { background-color: #3b82f6; }
        .bg-gray-400 { background-color: #9ca3af; }
        .bg-gray-200 { background-color: #e5e7eb; }
        .opacity-50 { opacity: 0.5; }

        .session-select {
            -webkit-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='white'%3E%3Cpath d='M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.3rem center;
            background-size: 1.2em;
            color: white !important;
            width: 100%;
            border-radius: 0.5rem;
            border: 2px solid transparent;
            padding: 0.5rem 0.2rem;
            font-weight: bold;
            text-align: center;
        }

        /* Mem√≥ria de C√°lculo */
        .calculation-memo {
            background-color: #fdfdfd;
            font-size: 0.7rem;
            color: #4b5563;
            border-bottom: 1px solid #e5e7eb;
            padding: 0.5rem;
            line-height: 1.2;
        }
        .calculation-memo b { color: #111827; }

        /* Cards de Pre√ßo */
        .price-card { padding: 0.75rem; border-radius: 0.75rem; border: 2px solid; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .yellow-card { border-color: #f59e0b; background-color: rgba(245, 158, 11, 0.05); color: #b45309; }
        .green-card { border-color: #10b981; background-color: rgba(16, 185, 129, 0.05); color: #047857; }
        .blue-card { border-color: #3b82f6; background-color: rgba(59, 130, 246, 0.05); color: #1d4ed8; }
    </style>
</head>
<body class="p-4">

    <div class="container mx-auto">
        <!-- CABE√áALHO -->
        <h1 class="text-3xl font-extrabold text-indigo-800 mb-6 border-b-4 border-indigo-200 pb-2">
            üí™ Personal Trainer Heleninha | Pagamento Total üí∞
        </h1>
        
        <!-- Regras de Pre√ßo Fixo -->
        <div class="bg-white shadow-xl rounded-2xl p-4 mb-8 border border-indigo-100">
            <h2 class="text-xl mb-4">Regras de Pre√ßo da Sess√£o</h2>
            <div class="grid grid-cols-3 gap-3 text-center" id="price-cards-container">
                <!-- Cards Gerados pelo JS -->
            </div>
        </div>

        <!-- Totalizador -->
        <div class="bg-indigo-600 text-white p-4 rounded-xl shadow-lg mb-8">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center">
                <span class="text-lg font-medium">Pagamento Total Estimado (13 Meses):</span>
                <span class="text-3xl font-bold mt-1 sm:mt-0" id="grand-total-display">R$ 0,00</span>
            </div>
            <p class="text-xs opacity-80 mt-1">Este √© o valor acumulado no per√≠odo de planejamento.</p>
        </div>

        <!-- Grade de 13 Meses -->
        <div class="space-y-6">
            <h2 class="text-xl">Previs√£o Mensal e Mem√≥ria Cont√°bil</h2>
            <p class='text-xs text-gray-500 mb-2 italic'>Clique nos c√≠rculos coloridos para alterar o n√∫mero de alunos na aula.</p>
            
            <div class="overflow-x-auto shadow-md rounded-xl border border-gray-200">
                <table class="min-w-full bg-white" id="monthly-table">
                    <thead class="bg-indigo-50 border-b border-gray-200">
                        <tr>
                            <th class="py-3 px-2 text-left text-xs font-semibold text-indigo-700 uppercase sticky left-0 bg-indigo-50 z-10">M√™s</th>
                            <th class="py-3 px-1 text-center text-xs font-semibold text-indigo-700 uppercase">Semanas</th>
                            <th class="py-3 px-1 text-center text-xs font-semibold text-indigo-700 uppercase w-12">S1</th>
                            <th class="py-3 px-1 text-center text-xs font-semibold text-indigo-700 uppercase w-12">S2</th>
                            <th class="py-3 px-1 text-center text-xs font-semibold text-indigo-700 uppercase w-12">S3</th>
                            <th class="py-3 px-1 text-center text-xs font-semibold text-indigo-700 uppercase w-12">S4</th>
                            <th class="py-3 px-1 text-center text-xs font-semibold text-indigo-700 uppercase w-12">S5</th>
                            <th class="py-3 px-2 text-right text-xs font-semibold text-indigo-700 uppercase">Total</th>
                        </tr>
                    </thead>
                    <tbody id="monthly-body">
                        <!-- Conte√∫do Gerado pelo JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Rodap√© -->
        <div class="mt-8 pt-4 border-t text-[10px] text-gray-400 text-center">
          <p>Aplica√ß√£o Offline (Heleninha Trainer). Todos os dados s√£o salvos localmente.</p>
        </div>
    </div>

    <!-- Mensagem de Status -->
    <div id="status-message" class="fixed bottom-4 left-1/2 transform -translate-x-1/2 p-3 rounded-xl shadow-lg text-white font-medium bg-green-500 opacity-0 transition duration-300 pointer-events-none z-50">
        Dados salvos!
    </div>

    <script>
        const LOCAL_STORAGE_KEY = 'heleninha_trainer_data_v2';
        const MONTH_NAMES_PT = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
        const FIXED_SESSION_PRICES = { 1: 75.00, 2: 95.00, 3: 115.00 };

        let appData = { monthlyData: [] };

        const formatCurrency = (val) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(val);

        /** Retorna os dias (n√∫meros) de todas as segundas-feiras do m√™s */
        const getMondaysInMonth = (year, month) => {
            let mondays = [];
            let date = new Date(year, month, 1);
            while (date.getMonth() === month) {
                if (date.getDay() === 1) mondays.push(date.getDate());
                date.setDate(date.getDate() + 1);
            }
            return mondays;
        };

        const loadData = () => {
            const today = new Date();
            const start = new Date(today.getFullYear(), today.getMonth() - 1, 1);
            let months = [];

            for (let i = 0; i < 13; i++) {
                let d = new Date(start.getFullYear(), start.getMonth() + i, 1);
                let y = d.getFullYear();
                let m = d.getMonth();
                months.push({
                    monthYear: `${y}-${String(m + 1).padStart(2, '0')}`,
                    label: `${MONTH_NAMES_PT[m]} ${y}`,
                    year: y,
                    monthIdx: m,
                    weeks: [0, 0, 0, 0, 0],
                    mondays: getMondaysInMonth(y, m)
                });
            }

            const stored = localStorage.getItem(LOCAL_STORAGE_KEY);
            if (stored) {
                const parsed = JSON.parse(stored);
                months = months.map(m => {
                    const saved = parsed.monthlyData.find(s => s.monthYear === m.monthYear);
                    if (saved) m.weeks = saved.weeks;
                    return m;
                });
            }
            appData.monthlyData = months;
            render();
        };

        const saveData = () => {
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify({ monthlyData: appData.monthlyData }));
            const status = document.getElementById('status-message');
            status.style.opacity = '1';
            setTimeout(() => status.style.opacity = '0', 1500);
            render();
        };

        const handleSelect = (mIdx, wIdx, val) => {
            appData.monthlyData[mIdx].weeks[wIdx] = parseInt(val);
            saveData();
        };

        const render = () => {
            // Render Cards
            const cards = document.getElementById('price-cards-container');
            cards.innerHTML = `
                <div class="price-card yellow-card"><p class="text-sm font-bold">Solo</p><p class="text-lg font-extrabold">R$ 75</p></div>
                <div class="price-card green-card"><p class="text-sm font-bold">Duo</p><p class="text-lg font-extrabold">R$ 95</p></div>
                <div class="price-card blue-card"><p class="text-sm font-bold">Trio</p><p class="text-lg font-extrabold">R$ 115</p></div>
            `;

            // Render Table
            const tbody = document.getElementById('monthly-body');
            tbody.innerHTML = '';
            let grandTotal = 0;

            appData.monthlyData.forEach((m, mIdx) => {
                let monthTotal = 0;
                let calcParts = [];
                
                m.weeks.forEach((q, wIdx) => {
                    if (q > 0) {
                        const price = FIXED_SESSION_PRICES[q];
                        monthTotal += price;
                        const date = m.mondays[wIdx] ? String(m.mondays[wIdx]).padStart(2, '0') : '--';
                        calcParts.push(`${date} (${q} alunos ${price})`);
                    }
                });
                grandTotal += monthTotal;

                const isCurrent = m.monthYear === `${new Date().getFullYear()}-${String(new Date().getMonth() + 1).padStart(2, '0')}`;
                
                // Row de inputs
                const trData = document.createElement('tr');
                trData.className = isCurrent ? "bg-indigo-100/50" : "";
                trData.innerHTML = `
                    <td class="py-3 px-2 text-xs font-bold sticky left-0 ${isCurrent ? 'bg-indigo-100' : 'bg-white'} z-0">
                        ${m.label.split(' ')[0]}<br><span class="text-[9px] font-normal text-gray-400">${m.label.split(' ')[1]}</span>
                    </td>
                    <td class="text-center text-xs font-medium">${m.mondays.length}</td>
                    ${[0,1,2,3,4].map(wIdx => {
                        const q = m.weeks[wIdx];
                        const disabled = wIdx >= m.mondays.length;
                        const color = q === 0 ? "bg-red-500" : q === 1 ? "bg-yellow-500" : q === 2 ? "bg-green-500" : "bg-blue-500";
                        return `
                            <td class="px-1 ${disabled ? 'bg-gray-100' : ''}">
                                <select onchange="handleSelect(${mIdx}, ${wIdx}, this.value)" class="session-select ${color} ${disabled ? 'opacity-20 pointer-events-none' : ''}" ${disabled ? 'disabled' : ''}>
                                    <option value="0" ${q===0?'selected':''}>0</option>
                                    <option value="1" ${q===1?'selected':''}>1</option>
                                    <option value="2" ${q===2?'selected':''}>2</option>
                                    <option value="3" ${q===3?'selected':''}>3</option>
                                </select>
                            </td>
                        `;
                    }).join('')}
                    <td class="py-3 px-2 text-right text-xs font-bold">${formatCurrency(monthTotal)}</td>
                `;
                tbody.appendChild(trData);

                // Row de Mem√≥ria de C√°lculo
                if (monthTotal > 0) {
                    const trMemo = document.createElement('tr');
                    trMemo.innerHTML = `
                        <td colspan="8" class="calculation-memo">
                            <b>Contabilidade:</b> ${m.label.split(' ')[0]} com ${m.mondays.length} semanas. 
                            Segundas: ${calcParts.join(', ')}. 
                            Total: <b>${formatCurrency(monthTotal)}</b>
                        </td>
                    `;
                    tbody.appendChild(trMemo);
                }
            });

            document.getElementById('grand-total-display').textContent = formatCurrency(grandTotal);
        };

        window.onload = loadData;
    </script>
</body>
</html>
